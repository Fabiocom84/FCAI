<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inserisci Dati - Segretario AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
    <link rel="stylesheet" href="style-v2.css">
    <link rel="stylesheet" href="inserisci-dati.css">
</head>
<body>

    <div class="page-wrapper">
        <!-- Header standard coerente con le altre pagine -->
        <header class="page-header">
            <a href="index.html" class="header-button">
                <img src="img/log-out.png" alt="Home" style="transform: rotate(180deg); filter: brightness(0) invert(1);">
                <span>Home</span>
            </a>
            <h1>Inserimento Dati</h1>
            <!-- Pulsante Aiuto -->
            <button class="help-button" id="pageHelpBtn" data-legend="insertLegend">?</button>
        </header>

        <div class="insert-container">
            <form id="insertDataForm">
                
                <!-- SEZIONE 1: REGISTRAZIONE VOCALE -->
                <div class="card-section recording-section">
                    <div class="section-header">
                        <img src="img/mic.png" alt="Mic">
                        <h3>Registrazione Vocale</h3>
                    </div>
                    
                    <div class="recording-ui">
                        <div id="visualizer" class="audio-visualizer">
                            <div class="bar"></div><div class="bar"></div><div class="bar"></div>
                            <div class="bar"></div><div class="bar"></div>
                        </div>
                        <p id="recordingStatus" class="status-text">Pronto per registrare</p>
                        
                        <div class="voice-controls-large">
                            <button type="button" id="startButton" class="record-btn">
                                <span class="icon">üéôÔ∏è</span> Avvia
                            </button>
                            <button type="button" id="stopButton" class="stop-btn" disabled>
                                <span class="icon">‚èπÔ∏è</span> Ferma & Trascrivi
                            </button>
                        </div>
                    </div>
                </div>

                <!-- SEZIONE 2: TESTO E RIFERIMENTO -->
                <div class="card-section content-section">
                    <div class="section-header">
                        <img src="img/chat.png" alt="Edit">
                        <h3>Contenuto e Riferimento</h3>
                    </div>
                    
                    <div class="form-group">
                        <label for="voiceTranscription">Note / Trascrizione</label>
                        <textarea id="voiceTranscription" name="contenuto_testo" placeholder="Il testo trascritto o digitato apparir√† qui..."></textarea>
                    </div>

                    <div class="form-group styled-choices-container">
                        <label for="riferimentoDropdown">Associa a Commessa (Opzionale)</label>
                        <select id="riferimentoDropdown" name="id_commessa_fk">
                            <option value="" selected>Nessuna associazione</option>
                        </select>
                    </div>
                </div>

                <!-- SEZIONE 3: ALLEGATI -->
                <div class="card-section attachment-section">
                    <div class="section-header">
                        <img src="img/file.png" alt="File">
                        <h3>Allegati</h3>
                    </div>
                    
                    <label for="fileUpload" class="file-drop-zone">
                        <span class="drop-icon">üìÇ</span>
                        <span class="file-name">Clicca per caricare un file...</span>
                        <input type="file" id="fileUpload" name="fileUpload" hidden>
                    </label>
                </div>

                <!-- FOOTER AZIONI -->
                <div class="form-actions">
                    <button type="submit" id="saveDataBtn" class="button button--primary big-save-btn">
                        <img src="img/save.png" alt="Save">
                        <span>SALVA DATI</span>
                    </button>
                </div>

            </form>
        </div>
    </div>

    <!-- LEGENDA AIUTO -->
    <div id="insertLegend" class="legend" style="display: none;">
        <h3>Guida Inserimento</h3>
        <div class="legend-item"><div class="legend-text"><strong>Vocale:</strong> Premi "Avvia" e parla. Premi "Ferma" per trascrivere automaticamente.</div></div>
        <div class="legend-item"><div class="legend-text"><strong>Testo:</strong> Puoi modificare manualmente la trascrizione o scrivere direttamente.</div></div>
        <div class="legend-item"><div class="legend-text"><strong>Salvataggio:</strong> I dati verranno salvati nella tabella 'Registrazioni'.</div></div>
    </div>

    <!-- Modale Feedback (riutilizziamo quello standard) -->
    <div id="success-feedback-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header"><h2 id="feedback-modal-title"></h2><div class="modal-header-buttons"><button class="close-button" data-close-feedback>&times;</button></div></div>
            <div class="modal-body feedback-body"><h3 id="feedback-modal-message"></h3><p id="feedback-modal-countdown"></p></div>
            <div class="modal-footer"><button id="feedback-modal-close-btn" class="save-button">OK</button></div>
        </div>
    </div>
    <div id="modalOverlay" class="modal-overlay"></div>

    <!-- Script -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/auth-guard.js"></script>
    <script type="module" src="js/api-client.js"></script>
    <script type="module" src="js/shared-ui.js"></script>
    <script type="module" src="js/legend.js"></script>
    <script type="module" src="js/inserisci-dati.js"></script>

</body>
</html>